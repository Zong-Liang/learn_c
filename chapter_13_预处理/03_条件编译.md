# 03_条件编译.md

C语言预处理器提供了条件编译功能。一般情况下，源程序中的所有行都会参加编译。如果希望其中一部分内容只在满足一定条件时才进行编译，这时就需要使用条件编译命令。使用条件编译可以非常方便地处理程序的调试版本和正式版本，同时还会增强程序的可移植性。

## `#if`命令

`#if`的基本含义是：如果`#if`命令后的参数表达式为真，则编译`#if`到`#endif`之间的程序段，否则跳过这段程序。`#endif`命令用来表示`#if`段的结束。

```c
#if 常数表达式
	语句段
#endif
```

如果常数表达式为真，则该段程序被编译，否则跳过该段程序（不编译）。

`#else`的作用是为#if为假时提供另一种选择，其作用和前面讲过的条件判断中的`else`相近。

`#elif`指令用来建立“如果…… 或者如果……”这样阶梯状多重编译操作选择，与多分支`if`语句中的`else if`类似。

```c
#if 表达式1
	语句1;
#elif 表达式2
	语句2;
#elif 表达式3
	语句3;
	...
#elif 表达式n
	语句4;
#endif
```

## `#ifdef`及`#ifndef`命令

在`#if`条件编译命令中，需要判断符号常量所定义的具体值。但有时并不需要判断具体值，只需要知道这个符号常量是否被定义了，这时可以采用另一种条件编译的方法，即`#ifdef`与`#ifndef`命令，分别表示“如果有定义”及“如果无定义”。

```c
#ifdef 宏替换名
	语句;
#endif
```

其含义是：如果宏替换名已被定义过，则对语句段进行编译；如果未定义`#ifdef`后面的宏替换名，则不对语句段进行编译。

`#ifdef`可与`#else`连用。

```c
#ifdef 宏替换名
	语句1;
#else2
	语句2;
#endif
```

如果宏替换名已被定义过，则对语句1进行编译；如果未定义`#ifdef`后面的宏替换名，则对语句2进行编译。

```c
#ifndef 宏替换名
	语句;
#endif
```

其含义是：如果未定义`#ifndef`后面的宏替换名，则对语句段进行编译；如果定义`#ifndef`后面的宏替换名，则不执行语句段。

`#ifndef`也可以与`#else`连用

```c
#ifndef 宏替换名
	语句1;
#else2
	语句2;
#endif
```

其含义是：如果未定义`#ifndef`后面的宏替换名，则对语句1进行编译；如果定义`#ifndef`后面的宏替换名，则对语句2进行编译。

## `#undef`命令

使用`#undef`命令可以删除事先定义好的宏定义。

```c
#undef 宏替换名
```

使用`#undef`命令可将宏名限制在特定的代码段中。

```c
#define MAX_SIZE 100
char array[MAX_SIZE];
#undef MAX_SIZE
```

上述代码中，首先使用`#define`定义标识符`MAX_SIZE`，然后使用`#undef`删除宏定义。也就是说，遇到`#undef`语句之前，`MAX_SIZE`的定义都是有效的。

## `#line`命令

`#line`命令用于显示`_LINE_`与`_FILE_`的内容。`_LINE_`用于存放当前编译行的行号，`_FILE_`用于存放当前编译的文件名。

```c
#line 行号["文件名"]
```

其中，行号为任一正整数，可选的文件名为任意有效文件标识符。行号为源程序中当前行号，文件名为源文件的名字。`#line`命令主要用于调试及其他特殊应用。

## `#pragma`命令

`#pragma`命令用于设定编译器状态，或指示编译器完成一些特定动作。

```c
#pragma 参数
```

- `message`参数：在编译信息窗口中输出的相应信息。

- `code_seg`参数：设置程序中函数代码存放的代码段。

- `once`参数：保证头文件被编译一次。

## 预定义宏名

ANSI标准说明了以下5个预定义宏替换名。

- `__LINE__`：当前被编译代码的行号
- `__FILE__`：当前源程序的文件名称
- `__DATE__`：当前源程序的创建日期
- `__TIME__`：当前源程序的创建时间
- `__STDC__`：判断当前编译器是否为标准C。其值为1，是标准C，否则不是标准C。

宏名的书写比较特别，书写时两边都要由下画线构成。如果编译不是标准的，则可能仅支持以上宏名中的几个，或根本不支持。编译程序有时还提供其他预定义的宏名。
