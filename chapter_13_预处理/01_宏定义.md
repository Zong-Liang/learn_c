# 01_宏定义

宏定义是预处理命令的一种，它提供了一种可以替换源代码中字符串的机制。简单来说，宏定义指令`#define`用来定义一个标识符和一个字符串，以这个标识符来代表这个字符串，在程序中每次遇到该标识符时就用所定义的字符串替换它。宏定义的作用相当于给指定的字符串起了一个别名。

> C语言并没有规定`#define`必须写在函数外面，只是规定这条命令必须单独占一个完整的逻辑行。其作用范围是`#define`出现的位置到所在源文件结束，或到相应的`#undef`预处理指令处。如果需要`#define`预处理命令仅在某个函数内有效，完全可以把它写在函数内。

## 不带参数的宏定义

```c
#define 宏名 字符串
```

- “#”表示这是一条预处理命令。

- 宏名是一个标识符，必须符合C语言中对标识符的限定。宏名要简单且意义明确，一般习惯用大写字母表示，以便与变量名相区别。
- 字符串可以是常数、表达式、格式字符串等。

```c
#define PI 3.1415926
```

关于不带参数的宏定义，有以下几点需要注意。

- 如果在字符串中出现宏名，则不进行替换。
- 如果字符串多于一行，可在行末用反斜杠“\”进行续行。
- `#define`命令出现函数外时，宏名的有效范围为定义命令之后到此源文件结束。

- 可以用`#undef`命令终止宏定义的作用域
- 宏定义是一种预处理命令，不同于变量定义，它只做字符替换，而不分配内存空间。

## 带参数的宏定义

```c
#define 宏名(参数表) 字符串
```

```c
#define MIX(a,b) ((a+b)*(a-b))

int main() {
    int a = 6, b = 4;
    printf("%d\n", MIX(a, b));
}
```

用宏替换代替实在的函数，好处是可以提升代码速度（不再存在函数调用），代价是由于重复编码，增加了程序长度。

对于带参数的宏定义，有以下几点需要注意。

- 宏定义时，参数要加括号。
- 宏扩展必须使用括号来保护表达式中优先级低的操作符，以确保调用时能达到预期效果。
- 对带参数的宏的展开，只是用宏名后括号内的实参字符串代替`#define`命令行中的形参。
- 宏定义时，宏名与带参数的括号之间不要加空格，否则会将空格以后的字符都作为替代字符串的一部分。
- 在带参宏定义中，形式参数不分配内存单元，因此不必做类型定义。
