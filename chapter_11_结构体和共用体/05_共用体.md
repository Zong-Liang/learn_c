# 05_共用体

共用体看起来很像结构体，只不过关键字由`struct`变成了`union`。共用体和结构体的区别在于：结构体定义了一个由多个数据成员组成的特殊类型，而共用体定义了一块为所有数据成员共享的内存。

## 共用体的概念

共用体也称为联合体，它使几种不同类型的变量存放到同一段内存单元中。共用体在某一时刻只能有一个值，即某个数据成员的值。由于所有成员共用同一块内存，因此共用体的大小就等于最大成员的大小。

```c
union 共用体名{
    成员列表;
}变量列表;
```

```c
union Data_Union{
    int i_1;
    char c_1;
    float f_1;
}variable;

variable.c_1 = 'a';


struct Data_Union{
    int i_1;
    char c_1;
    float f_1;
}variable;
variable.i_1 = 5;
variable.c_1 = 'a';
variable.f_1 = 3.14f;
```



其中，`variable`为定义的共用体变量，而`union data_union`是共用体类型。共用体也可以像结构体那样，将类型的声明和变量的定义分开。

```c
union Data_Union variable;
```

> 需要注意的是，结构体变量的大小是其所包括的所有数据成员大小的总和，其每个成员都有自己的内存单元；共用体的大小则为所包含数据成员中最大内存长度的大小。例如，上面定义的共用体变量`variable`的大小就与`float`类型的大小相等。

## 共用体变量的引用

共用体变量定义完成后，就可以引用其中的数据成员，引用形式为`共用体变量.成员名`。

```c
variable.i_1;
variable.c_1;
variable_f_1;
```

> 注意，不能在输出语句中直接引用共用体变量，如`printf("%d"，variable);`。

## 共用体变量的初始化

定义共用体变量时，可以同时进行初始化操作。同样，初始化值需要放在一对大括号中。

注意，对共用体变量初始化时，只需要一个初始化值就足够了，其类型必须和共用体的第一个成员的类型相一致。如果共用体的第一个成员是一个结构体类型，则初始化值中可以包含多个用于初始化该结构体的表达式。

> 共用体变量可以赋值吗？其实是可以的，只是赋的值仍然是一个相同类型的共用体类型。引用共用体变量名也可以得到一个值，这个值就是共用体对象本身的值。

## 共用体类型的数据特点

- 同一内存虽然可用来存放不同类型的成员，但每次只能存放一种类型，而不能同时存放所有类型。也就是说，共用体中只有一个成员能起作用，其他成员不起作用。
- 共用体变量中，起作用的永远是最后存放的成员。存入新成员后，原有的成员将失去作用。
- 共用体变量的地址和它的各成员地址是一样的。
- 不能对共用体变量名赋值，也不能企图引用变量名来得到一个值。