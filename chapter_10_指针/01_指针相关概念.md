# 01_指针相关概念

指针是C语言的一个重要组成部分，是C语言的核心、精髓所在。用好指针，可以在C语言开发中起到事半功倍的效果。一方面，可以提高程序的编译效率、执行速度，以及动态存储分配；另一方面，可使程序更加灵活，表示和操作各种数据结构更便捷，编写出高质量的应用程序。

## 地址与指针

通常来说，系统会按字节对每个内存单元进行编号，这些内存单元就好比是许多带有编号的小房间，要想使用内存，就需要知道房间编号。例如，定义一个整型变量`i`需要4个字节，编译器就会为其分配4个内存单元，如下所示，1000~1003就是对应变量i的4个内存单元地址，其内存放的数值是0。

前面我们学习过取地址符`&`，其作用是获取变量在内存中的地址。例如，`&i`表示变量`i`的内存起始地址1000。通过`&i`可访问变量`i`指向的内存单元，进而读取变量`i`。

<img src="https://cdn.jsdelivr.net/gh/ZL85/ImageBed@main//202401291818741.png" alt="Snipaste_2024-01-29_18-18-33" style="zoom: 25%;" />

<img src="https://cdn.jsdelivr.net/gh/ZL85/ImageBed@main//202401291819207.png" alt="Snipaste_2024-01-29_18-19-31" style="zoom: 33%;" />

<img src="https://cdn.jsdelivr.net/gh/ZL85/ImageBed@main//202401291820086.png" alt="Snipaste_2024-01-29_18-20-25" style="zoom:33%;" />

为了好记忆，我们将变量的地址形象化地称为该变量的“指针”，意思是通过它能访问以它为地址的内存单元。例如，通过地址1000可以访问变量`i`的地址，进而读取4个字节得到i的值。

## 变量与指针

变量的地址是变量和指针之间的连接纽带。所谓“指向”，是通过地址来体现的。因为指针变量通常指向一个变量的地址，所以将一个变量的地址赋给指针变量后，这个指针变量就“指向”了该变量。

<img src="https://cdn.jsdelivr.net/gh/ZL85/ImageBed@main//202401291828470.png" alt="Snipaste_2024-01-29_18-28-37" style="zoom: 67%;" />

程序代码中一般通过变量名对内存单元进行存取操作，但代码编译后，会将变量名转换为该变量在内存中的存放地址，后续对变量值的存取都是通过该地址进行的。

```c
i + j;
```

计算机内部的存取流程是：根据变量名与地址的对应关系，找到变量`i`的地址1000，然后从1000开始读取4个字节数据放到CPU寄存器中，再找到变量`j`的地址1004，从1004开始读取4个字节的数据放到CPU的另一个寄存器中，通过CPU的加法中断计算出结果。

> 低级语言（如汇编语言）中一般直接通过地址来访问内存单元，高级语言中一般使用变量名来访问内存单元。C语言作为高级语言，仍然提供了通过地址来访问内存单元的方式。

## 指针变量

一个变量的地址称为该变量的指针。如果有一个变量专门用来存放另一个变量的地址，它就是指针变量。在C语言中有专门用来存放内存单元地址的变量类型，即指针类型。

### 指针变量的定义

```c
类型说明 *变量名;
```

其中，`*`表示该变量是一个指针变量，`变量名`即为定义的指针变量名，`类型说明`表示本指针变量所指向的变量的数据类型。

### 指针变量的赋值

指针变量同普通变量一样，使用前需要先进行定义并赋予具体的值。未经赋值的指针变量不能使用。与其他变量赋值不同，给指针变量赋值只能赋予地址，而不能是其他数据，否则将引起错误。C语言一般用`&变量名`表示某个变量的地址，如`&a`表示变量`a`的地址，`&b`表示变量`b`的地址。

给一个指针变量赋值可以有以下两种方法。

- 定义指针变量的同时进行赋值。

```c
int a = 5;
int *p = &a;
```

- 先定义指针变量，之后再赋值。

```c
int a = 5;
int *p;
p = &a;
```

> 注意这两种赋值语句的区别。如果先定义指针变量之后再赋值，赋值时指针变量前不再加`*`。

### 指针变量的引用

引用指针变量是对变量进行间接访问的一种形式。引用指针变量的形式为`*指针变量`，其含义是引用指针变量所指向的值。

> 没有初始化的指针变量俗称“野指针”，使用时容易产生错误（导致不合法的内存空间）。良好的编程习惯是在定义指针变量时就将其初始化为`NULL`，由于`NULL`处禁止写入，所以一旦有错误，可以将错误造成的危害降到最小。

### `&`和`*`运算符

运算符`&`和`*`都是单目运算符。`&`是取地址运算符，用于返回一个操作数的地址。`*`是指针运算符，用于返回指定地址内保存的变量值。

例如，`p=&i;`是将变量i的内存地址赋给指针变量`p`。`q=*p;`是将指针`p`指向的变量，即变量`i`的值赋给`q`，假如变量`i`的值是5，则`q`的值也是5。

### `&*`和`*&`的区别

```c
int a;
p = &a;
```

因为`&`和`*`的优先级相同，按自右而左的方向结合，因此`&*p`先进行`*`运算，`*p`相当于变量`a`；再进行`&`运算，`&*p`就相当于取变量`a`的地址。`*&a`先进行`&`运算，`&a`就是取变量`a`的地址，然后执行`*`算，`*&a`就相当于取变量`a`所在地址的值，实际就是变量`a`。

## 指针的自增、自减运算

指针的自增自减运算不同于普通变量的自增自减运算，也就是说，并非简单地加1减1，而是按照它所指向的数据类型的直接长度进行增减。